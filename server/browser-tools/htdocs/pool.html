<html lang="en">
<head>
<link rel="stylesheet" type="text/css" href="css/diQuery-collapsiblePanel.css">
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.scrollTo-1.4.2-min.js"></script>
<script type="text/javascript" src="js/URI.js"></script>
<script type="text/javascript" src="js/base64.js"></script>
<script type="text/javascript" src="js/api.js"></script>
<link rel="stylesheet" type="text/css" href="css/style.bundle.css">
<link rel="stylesheet" type="text/css" href="css/vendors.bundle.css">
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>

<script>
  WebFont.load({
    google: {"families":["Poppins:300,400,500,600,700","Roboto:300,400,500,600,700"]},
    active: function() {
        sessionStorage.fonts = true;
    }
  });
</script>
</head>
<body>

<form id="header">
<div class="row">
     <div class="col-md-12">
         <center>
          <a href="https://iotblock.io">
        <img src="logo-32x32.png" style="float: right;width:81px;" border=0>
        </a>
        <div class="btn-group m-btn-group m-btn-group--pill">
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="pool.html">Smart Pool Key</a>
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="key.html">Smart Key</a>
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="browser.html">Catalogue browser and editor (text)</a>
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="explorer.html">Catalogue explorer (graphical)</a>
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="crawler.html">Catalogue crawler (graphical)</a>
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="map.html">Client side map demo</a>
            <!--
            <a class="btn m-btn--pill m-btn--air         btn-outline-info" href="validator.html">Catalogue syntax validator</a></li>
            //-->
        </div>
           </center>
    </div>
</div>
</form>
<form id="page1">


<div class="row">
     <div class="col-md-12">
            <div class="m-portlet m-portlet--tab">
                   <div class="m-portlet__head">
                          <br>
                          <center><label><h3>Find Smart Pool Key</h3></label></center>
                          <div class="row">
                                 <div class="col-md-12">
                                         <center>
                                         
                                             <input name="find_poolkey" class="form-control m-input m-input--air m-input--pill"  placeholder="Enter Smart Pool Key Address" style="width:50%" type="text" id="find_poolkey" placeholder="" aria-invalid="false" aria-required="false">
                                             <br><button type="button" id='find_poolkey_btn' class="btn btn-accent"><h1>Find Pool Key</h1></button>
                                          </center>
                                          <br>
                                  </div>
                            </div>
 
                      </div>
                </div>
            
     </div>
</div>

<div class="row">
     <div class="col-md-12">
              <center><label><h3>Create Smart Pool Key</h3></label></center>
              <div class="row">
                     <div class="col-md-12">
                             <center>
                             
                                  <label><h5>Your wallet address</h5></label>
                                 <input name="address" class="address_val form-control m-input m-input--air m-input--pill"  style="width:50%" type="text" id="address" placeholder="" aria-invalid="false" aria-required="false">
                              </center>
                      </div>
                </div>
 
            <hr>
            
     </div>
</div>

<div class="row">
    <div class="col-md-12">    
        <div class="m-portlet m-portlet--tab">
               <div class="m-portlet__head">
                    <center>
            
                    <br>                    
                    <div class="row">
                         <div class="col-md-12">
                              <h3>Allocations</h3>
                         </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                                <label>Maximum Allocation (ETH)</label>
                        
                         </div>
                         <div class="col-md-6" align=left>
                
                                <input name="max_contrib" class="form-control m-input m-input--air m-input--pill"  matinput="" type="text" id="max_contrib" value='100000' placeholder="" aria-invalid="false" aria-required="false">
                         </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                            <label>Maximum Per Contributor (ETH)</label>
                        </div>
                         <div class="col-md-6" align=left>
                            <input name="max_per_contribr" class="form-control m-input m-input--air m-input--pill"  matinput="" type="text" id="max_per_contrib"  value='100000' placeholder="" aria-invalid="false" aria-required="false">
                         </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                            <label>Minimum Per Contributor (ETH)</label>
                        </div>
                         <div class="col-md-6" align=left>
                            <input name="min_per_contrib" class="form-control m-input m-input--air m-input--pill" matinput="" type="text" id="min_per_contrib" value='1' placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
            
                    <hr>
            
                    <div class="row">
                        <div class="col-md-12">
            
                          <h3>
                            Admins
                          </h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Admin 1 Wallet Address</label>
                          
                        </div>
                        <div class="col-md-6" align=left>
                          
                          <input name="admin1" class="address_val form-control m-input m-input--air m-input--pill"  type="text" id="admin1" placeholder="" aria-invalid="false" aria-required="false">
                      
                         </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Admin 2 Wallet Address</label>
                        </div>
                        <div class="col-md-6" align=left>
                            <input name="admin2" class="form-control m-input m-input--air m-input--pill"  matinput="" type="text" id="admin2" placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
                      
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Admin 3 Wallet Address</label>
                        </div>
                        <div class="col-md-6" align=left>
                            <input name="admin3" class="form-control m-input m-input--air m-input--pill"  matinput="" type="text" id="admin3" placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
                    
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-12">
                
                          <label><h3>Whitelist</h3></label>
                          
                                              
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right >
                          <label>Enable Whitelist</label>
                        </div>
                        <div class="col-md-6" align=left valign=middle>
                            <span class="m-switch m-switch--info">
												<label>
						                        <input type="checkbox" id="has_whitelist" value="Yes">
						                        <span></span>
						                        </label>
						                    </span>
                        </div>
                    </div>
                    
                    <!-- 
            
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Whitelist 1 Wallet Address</label>
                          
                        </div>
                        <div class="col-md-6" align=left>
                          
                          <input name="whitelist1" class="form-control m-input m-input--air m-input--pill"  type="text" id="whitelist1" placeholder="" aria-invalid="false" aria-required="false">
                      
                         </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Whitelist 2 Wallet Address</label>
                        </div>
                        <div class="col-md-6" align=left>
                            <input name="whitelist2" class="form-control m-input m-input--air m-input--pill" matinput="" type="text" id="whitelist2" placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
                      
                    <div class="row">
                        <div class="col-md-6" align=right>
                
                          <label>Whitelist 3 Wallet Address</label>
                        </div>
                        <div class="col-md-6" align=left>
                            <input name="whitelist3" class="form-control m-input m-input--air m-input--pill"  matinput="" type="text" id="whitelist3" placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
                    -->
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-12">
                          <h3>Fees</h3>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6" align=right>    
                          <label>Pool Fee Percentage</label>
                        </div>
                        <div class="col-md-6" align=left>
                        
                            <input name="fee" class="form-control m-input m-input--air m-input--pill"  matinput="" max="50" min="0" size="6" type="number" id="fee" placeholder="" aria-invalid="false" aria-required="false">
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-6" align=right>
                          Fee Percentage
                        </div>
                        <div class="col-md-6" align=left>
                                  <font size=2>Our Fee is fixed at 0.5%.</font>
                  
                          <div id='fee_struct' style="display:None;" align=left>
                                   
                                  <ul style="max-width:50%">
                                    <li><span id='you'></span> goes to you.</li>
                                    <li>0.5% goes to Our Fee.</li>
                                    <li><b>Total: <span id='total'>0.50%</span></b></li>
                                  </ul>
                        </div>         
                        </div>

                                       
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-12">    
                            <h3>TOKEN DISTRIBUTION</h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">  
                            <center>  
                            Distributes Tokens Automatically
                            </center>
                        </div>
                        <!--
                        <div class="col-md-6">    
                            <select name='auto' id='auto'>
                            Yes
                            </select>
                        </div>
                        //-->
                    </div>
                    
                    <hr>
            
                    <div class="row">
                        <div class="col-md-12">    
                            <button type="button" id='pool' class="btn btn-accent"><h1>Create Smart Pool Key</h1></button>
                            <br><br>
                        </div>
                    </div>
                    </center>
            </div>
        </div>
    </div>
</div>
            

</form>
<form id="loading" style="display:none;">
<img src="/images/wait.gif">
</form>
<form id="page2" style="display:none;">
<div class="row">
    <div class="col-md-12">    
        <center><h3>Pool Key Contract Address</h3></center><br>
    </div>
</div>
<div class="row">
    <div class="col-md-12">    

        <center><h3><pre id='poolkey'></pre></h3></center>

    </div>
</div>

<div class="row">
    <div class="col-md-12">    
        <hr>
    </div>
</div>
<div class="row">
    <div class="col-md-6">    
        <div class="m-portlet m-portlet--tab">
               <div class="m-portlet__head">
        
                    <br><br>                    
                    
                    <div class="row">
                        <div class="col-md-6">    
                            
                            <h3>ETH SENT TO POOL</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <h1><span class="eth_sent"></span></h1>
                                    <font size=2>ETH</font><br>
                                </div>
                                <div class="col-md-6">                            
                                    <h1><span class="fee"></span></h1>
                                    <font size=2>% Fee </font><br>
                                </div>
                            </div>                            
                            <br><br>
                            <div class="row">
                                <div class="col-md-6">
                                    <input id='send_amt' class="form-control m-input m-input--air m-input--pill" value=1>
                                </div>
                                <div class="col-md-6">
                                    <a href='#' class="btn m-btn--pill m-btn--air         btn-outline-info" id='send_ether'>Send Ether</a>
                                </div>
                            </div>
                            
                            
                        </div>
                        <div class="col-md-6">    
                            
                            <h3>ETH RECEIVED FROM POOL</h3>
                            <h1><span class="received"></span></h1> <font size=2>ETH</font>
                            
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                                <br><br>
                                <h4>
                                     
                                     <div class="progress m-progress--sm">
                						<div class="progress-bar m--bg-accent" role="progressbar" style="height:35px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                						<b><span class="eth_sent"></b>
                						</div>
                					</div>
                                    
                                </h4>
                                <br><br>
                        </div>
                    </div>
                    
                     <div class="row">
                        <div class="col-md-6">    
                            <h3>MIN PER CONTRIBUTOR</h3>
                            <h1><span class="min_per_contrib"></span></h1> <font size=2>ETH</font><br>
                            
                        </div>
                        <div class="col-md-6">    
                            <h3>MAX PER CONTRIBUTOR</h3>
                            <h1><span class="max_per_contrib"></span></h1> <font size=2> ETH</font><br>
                            
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <br><br><br>    
                        </div>
                    </div> 
                </div>
              </div>
             </div>
             <div class="col-md-6">    
                    <div class="m-portlet m-portlet--tab">
                           <div class="m-portlet__head">     
                               <br><br>
                               <div class="row>
                                   <div class="col-md-12">
                                       <h3 class='status'>Status: Open</h3>
                                       <br>
                                       <div id="contrib-stat" style="height: 250px;"></div>
                                       <br>
                                       <center>   
                                                <h3>MAX ALLOCATION</h3>
                                                <br>
                                                <h1><span class="max_contrib"></span></h1> <font size=2>ETH</font>
                                        </center> 
                                    </div>
                                    
                                </div>                               
    
                            </div>
                    </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="m-portlet m-portlet--tab">
                           <div class="m-portlet__head">
                               <br>
                               <center><h3>Transactions</h3></center> 
                                <hr>
                               <div id='transactions'>
                               </div>
                           </div>
                </div>
            </div>
        </div>
    </div>
</div>            

</form>
<script>
var isPool=true;
$( document ).ready(function() {
    
    $('#fee').on('change', function(e) {
        $('#fee_struct').show();
        
        var fee=parseFloat($('#fee').val());
        var you=fee - 0.5;
        var you_msg = you + '%';
        $('#you').html(you_msg);
        var total_msg = fee  + '%';
        $('#total').html(total_msg);
        
        
        
    });
    
    $('#find_poolkey_btn').on('click',function(e) {
         var poolkey=$('#find_poolkey').val();
         page2(poolkey);
    });

    function fill_page2(address, eth_sent, contrib_total, max_contrib, max_per_contrib, min_per_contrib, fee, received) {
    
       $('#page1').hide();
       $('#loading').hide();
       $('#page2').show();
       
        console.log(eth_sent, contrib_total, max_contrib, max_per_contrib, min_per_contrib, fee);
       $('.eth_sent').html(eth_sent);
       $('.max_contrib').html( max_contrib);
       $('.max_per_contrib').html(max_per_contrib);
       $('.min_per_contrib').html(min_per_contrib);
       $('.fee').html(fee);
       $('.received').html(received);
       $('.progress-bar').val(eth_sent/max_per_contrib * 100);
       $('#poolkey').html('<pre>' + address + '</pre>');
       Morris.Donut({
          element: 'contrib-stat',
          data: [
            {label: "Contributed ETH", value: contrib_total},
            {label: "Available ETH", value:  max_contrib-contrib_total},
          ]
        });
        
        
        
        $('#send_ether').on('click', function(e) {
               var eth1=1000000000000000000;
               var amt=parseInt($('#send_amt').val()) * eth1;
               send_ether(address, amt);
       });       
       
       get_pool_transactions(address, fill_page2_transactions);
    }  

    function fill_page2_transactions(sender, date, amount) {
            console.log(sender, date, amount);
            var dateTime = new Date(parseInt(date) * 1000);
            date=dateTime.toISOString(); 
            var eth1=1000000000000000000;
            var html ="<div class=row><div class=col-md-4>";
            html +='<b>Date:</b><br> ' + date + "</div><div class=col-md-4>";
            html +='<b>Sender:</b><br> ' + sender + "</div><div class=col-md-4>";
            html +='<b>Amount:</b><br> ' + amount/eth1 + " ETH</div>";
            html +="</div><hr><br>";
            
            $('#transactions').append(html);
    }    
    function page2(address) {
             
       $('#page1').hide();
       $('#loading').show();
       $('#page2').hide();
         
       get_pool(address, fill_page2);
    }
    
    $('#pool').on('click', function (e) {
        var fee=Math.round(1 / parseFloat($('#fee').val() / 100));
        var whitelist=[];
        var admins=[];
        var has_whitelist=false;
        /*
        if ($('#whitelist1').val().length > 0) {
            whitelist.push($('#whitelist1').val());
        }
        if ($('#whitelist2').val().length > 0) {
            whitelist.push($('#whitelist2').val());
        }
        if ($('#whitelist3').val().length > 0) {
            whitelist.push($('#whitelist3').val());
        }
        */
        if ($('#has_whitelist')[0].checked) {
            has_whitelist=true;
        }
        
        if ($('#admin1').val().length > 0) {
            admins.push($('#admin1').val());
        }
        if ($('#admin2').val().length > 0) {
            admins.push($('#admin2').val());
        }
        if ($('#admin3').val().length > 0) {
            admins.push($('#admin3').val());
        }
        
        var eth1=1000000000000000000;
        var max_contrib=parseInt($('#max_contrib').val()) * eth1;
        var max_per_contrib=parseInt($('#max_per_contrib').val()) * eth1;
        var min_per_contrib=parseInt($('#min_per_contrib').val()) * eth1;
        
        var beneficiary=$('#address').val();
        
        add_pool(beneficiary, max_contrib, max_per_contrib, min_per_contrib, admins, has_whitelist, fee, page2);
   
    });
    
   
});
</script>
<script src="js/app.js"></script>
</body></html>